@model List<Publicacion>
@using Dominio

@{
    ViewData["Title"] = "Publicaciones";
    string filtroActual = ViewContext.HttpContext.Request.Query["filtro"].ToString();
}

<!-- Formulario de búsqueda -->
<div class="row py-3">
    <div class="col-6">
        <label class="form-label" for="txtFiltro">Buscar</label>
        <input class="form-control" type="text" id="txtFiltro" placeholder="Escribe para buscar publicaciones..." value="@filtroActual" />
    </div>
    
    <div class="col-6">
        <label class="form-label" for="selectEstado">Estado</label>

        <select id="selectEstado" class="form-select">
            <option value="0" selected>Cualquiera</option>
            <option value="1">Abierta</option>
            <option value="2">Cerrada</option>
            <option value="3">Cancelada</option>
        </select>
    </div>
    
</div>

<!-- Tabla de resultados -->
<table class="table table-striped table-hover">
    <thead>
        <tr>
            <th>Nombre</th>
            <th>Precio</th>
            <th>Estado</th>
            <th>Acciones</th>
        </tr>
    </thead>

    <tbody id="tablaPublicaciones">
        <partial name="TablaListado" model="Model" />
    </tbody>
</table>

<script>
    document.getElementById("txtFiltro").addEventListener("input", ActualizarTabla);
    document.getElementById("selectEstado").addEventListener("change", ActualizarTabla);

    function ActualizarTabla() {
        const filtro = document.getElementById("txtFiltro").value;
        const estado = document.getElementById("selectEstado").value;

        // Hago la petición de manera asíncrona para que no se reinicie la página.
        fetch(`/Publicaciones/BuscarPublicaciones?estado=${estado}&filtro=${filtro}`)
            // Obtengo la respuesta y la transformo en texto.
            .then(response => response.text())

            // Obtengo el texto y lo inserto en la tabla.
            .then(html => {
                document.getElementById("tablaPublicaciones").innerHTML = html;
            })

            // En caso de error, lo muestro en consola.
            .catch(error => console.error("Error al cargar publicaciones:", error));
    }
</script>